syntax = "proto3";
package z11n;

service Z11nService {
    rpc Heartbeat(Empty) returns (stream HeartbeatRsp) {}
    rpc Register(RegisterReq) returns (RegisterRsp) {}
    rpc Host(HostReq) returns (Empty) {}
}

message Empty {}

message HeartbeatRsp {
    // 指令类型枚举
    enum CmdType {
        // 啥也不干
        NOTHING = 0;
        // 打印日志
        PRINT = 1;
    }
    // 指令类型
    CmdType cmd_type = 1;
    // 指令内容
    string cmd_content = 2;
}

// 心跳消息请求结构体
message RegisterReq {
    // agent唯一编号，必填
    string agent_id = 1;
    // agent版本，必填
    string agent_version = 2;
}

// 心跳消息请求结构体
message RegisterRsp {
    // 认证token
    string token = 1;
}

message HostReq {
    SystemInfo system = 1;
}

message SystemInfo {
    optional string name = 1;
    optional string kernel_version = 2;
    optional string os_version = 3;
    optional string host_name = 4;
    string cpu_arch = 5;
    string kernel_long_version = 6;
    uint64 total_memory = 7;
    uint64 total_swap = 8;
    repeated Process processes = 9;
}

message Process {
    uint32 pid = 1;
    string name = 2;
    optional string exe = 3;
    string status = 4;
}